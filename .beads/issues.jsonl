{"id":"HT-bfy","title":"MAJOR: Type duplication between Record and domain types","description":"HabitRecord/Habit and EntryRecord/HabitEntry are nearly identical with only date format differences. Changes must be made in multiple places. Consider deriving domain types from records using mapped types.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:12.605647383Z","updated_at":"2025-12-16T15:37:12.605647383Z"}
{"id":"HT-za6","title":"Data Model: Add cycle detection utility","description":"Create utility to detect cycles when adding parent-child relationships.\n\nPrevent:\n- Tag A contains Tag B, Tag B contains Tag A\n- Any circular dependency in the DAG\n\nImplementation:\n- Function: wouldCreateCycle(parentId, childId, allHabits) -\u003e boolean\n- Use DFS/BFS to check if adding edge creates cycle","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T22:22:25.828809841Z","updated_at":"2025-12-13T22:32:26.169175534Z","closed_at":"2025-12-13T22:32:26.169175534Z","dependencies":[{"issue_id":"HT-za6","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.593641648Z","created_by":"daemon"}]}
{"id":"HT-y2o","title":"CRITICAL: Missing unit tests for entryRepository.ts","description":"No test file exists for critical data layer. Handles all habit entry CRUD and date conversions. Need tests for: toEntry() date normalization, getForDateRange() boundaries, add() ID generation, subscribeForDateRange() error handling.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:35:56.001389643Z","updated_at":"2025-12-16T16:23:32.927040455Z","closed_at":"2025-12-16T16:23:32.927040455Z"}
{"id":"HT-q4o","title":"MAJOR: Missing keyboard navigation in TagChildPicker.tsx","description":"Lines 93-117: Picker has Escape key support but no Tab trapping or arrow key navigation for list of options. Add focus management and keyboard navigation.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:19.032692332Z","updated_at":"2025-12-16T15:36:19.032692332Z"}
{"id":"HT-i5f","title":"Phase 1: Database foundation (schema + repository)","description":"Add AudioRecordingRecord type, v11 schema migration, and audioRecordingRepository","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T22:19:20.020754471Z","updated_at":"2025-12-23T22:23:56.2687201Z","closed_at":"2025-12-23T22:23:56.2687201Z","dependencies":[{"issue_id":"HT-i5f","depends_on_id":"HT-8ks","type":"parent-child","created_at":"2025-12-23T22:19:30.486208573Z","created_by":"daemon"}]}
{"id":"HT-9l4","title":"githubService.dataUrlToBlob can throw unclear error on invalid base64","description":"**File:** `humane-tracker/src/services/githubService.ts:235`\n\nThe `atob()` function on line 235 will throw a DOMException if the base64 data is invalid (e.g., corrupted or truncated). The error message will be generic like \"Failed to execute 'atob' on 'Window'\".\n\n**Current code:**\n```typescript\nconst bstr = atob(base64Data);\n```\n\n**Impact:** If screenshot capture produces invalid base64 (rare but possible), error is cryptic.\n\n**Fix:** Wrap atob in try-catch with clear message:\n```typescript\nlet bstr: string;\ntry {\n  bstr = atob(base64Data);\n} catch {\n  throw new Error(\"Invalid base64 data in screenshot - data may be corrupted\");\n}\n```","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T19:28:32.773740809Z","updated_at":"2025-12-23T19:28:32.773740809Z"}
{"id":"HT-k5j","title":"habitValidation: validateHabitForm doesn't validate name/category length limits","description":"**File:** humane-tracker/src/utils/habitValidation.ts:18-33\n\n**Issue:** The validation only checks for empty strings but doesn't enforce:\n1. Maximum length limits (could cause DB/UI issues with extremely long names)\n2. Invalid characters (special characters that might break rendering)\n3. Duplicate name validation (would need habit list context)\n\n**Security concern:** Without length limits, a malicious or buggy input could create extremely long habit names that:\n- Break the UI layout\n- Exceed IndexedDB field limits\n- Cause performance issues when rendering\n\n**Recommendation:** Add length validation:\n```typescript\nif (data.name.trim().length \u003e 100) {\n  errors.name = \"Habit name must be 100 characters or less\";\n}\nif (data.category.trim().length \u003e 50) {\n  errors.category = \"Category must be 50 characters or less\";\n}\n```","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:29:04.869851772Z","updated_at":"2025-12-23T22:19:16.872052788Z","closed_at":"2025-12-23T22:19:16.872052788Z"}
{"id":"HT-d46","title":"Data integrity: bulkPut operations don't validate input data","description":"**Files:**\n- `src/repositories/entryRepository.ts:282-298` - `bulkPut()`\n- `src/repositories/habitRepository.ts:344-372` - `bulkPut()`\n- `src/repositories/affirmationLogRepository.ts:143-156` - `bulkPut()`\n\n**Problem:** The `bulkPut()` methods bypass all validation:\n\n1. `entryRepository.bulkPut()` doesn't call `validateEntryValue()` - but `add()` does\n2. `habitRepository.bulkPut()` doesn't call `validateHabitName()`, `validateCategory()`, or `validateTargetPerWeek()` - but `create()` does\n3. `affirmationLogRepository.bulkPut()` doesn't call `validateAffirmationLog()` - but `create()` does\n\n**Impact:** Import operations can insert invalid data that would be rejected through normal create paths. This can corrupt the database with:\n- Negative entry values\n- Empty habit names\n- targetPerWeek outside 1-7 range\n- Empty userId/affirmationTitle\n\n**Fix:** Add validation to bulkPut methods, or have them call the same validation path as create.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:28:03.211072848Z","updated_at":"2025-12-23T19:28:03.211072848Z"}
{"id":"HT-uzg","title":"Remove VariantPicker component","description":"Delete:\n- src/components/VariantPicker.tsx\n- src/components/VariantPicker.css\n\nUpdate HabitTracker.tsx:\n- Remove VariantPicker import\n- Remove variantPickerState\n- Remove handleVariantSelect\n- Remove variant-related long-press logic (keep tag long-press)\n- Remove has-variants CSS class usage","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:38:02.918832939Z","updated_at":"2025-12-13T23:54:04.755524512Z","closed_at":"2025-12-13T23:54:04.755524512Z","dependencies":[{"issue_id":"HT-uzg","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:22.008285177Z","created_by":"daemon"},{"issue_id":"HT-uzg","depends_on_id":"HT-4jf","type":"blocks","created_at":"2025-12-13T23:38:38.846335076Z","created_by":"daemon"}]}
{"id":"HT-ryi","title":"Extract duplicated formatTimeAgo/formatTimestamp helper to shared utility","description":"The formatTimeAgo/formatTimestamp function is duplicated across multiple files with nearly identical implementations. This violates DRY and makes maintenance harder.\n\nDuplicated in:\n- DebugLogsDialog.tsx:90-106 (formatRelativeTime)\n- SyncStatusDialog.tsx:112-124 (formatTimestamp)\n- SettingsDialog.tsx:21-33 (formatTimeAgo)\n- SyncSection.tsx:103-115 (formatTimeAgo)\n\nAll implementations follow the same pattern:\n1. Handle null case (return \"Never\")\n2. Calculate time diff in seconds\n3. Return \"Just now\" for \u003c10s\n4. Return \"Xs ago\" for \u003c60s\n5. Return \"Xm ago\" for \u003c60min\n6. Return \"Xh ago\" for \u003c24h\n7. Return date string for older\n\nShould be extracted to a shared utility in src/utils/ (e.g., timeUtils.ts or dateUtils.ts) and imported where needed.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:29:25.054963881Z","updated_at":"2025-12-23T19:29:25.054963881Z"}
{"id":"HT-mvg","title":"Type mismatch: Habit interface uses Date but HabitRecord uses string","description":"There's a type inconsistency between the domain type and the database record type for habit dates:\n\ntypes/habit.ts (lines 11-13):\n```typescript\nexport interface Habit {\n  // ...\n  createdAt: Date;\n  updatedAt: Date;\n```\n\nrepositories/types.ts (lines 25-26):\n```typescript\nexport interface HabitRecord {\n  // ...\n  createdAt: string; // ISO string\n  updatedAt: string; // ISO string\n```\n\nThe repository layer should handle conversion, but having both types defined separately creates maintenance burden and potential for misuse. The Habit type is exported from types/habit.ts but Habit entries come from repository calls that convert from HabitRecord.\n\nConsider consolidating type definitions or re-exporting from repositories/types.ts to enforce the single source of truth.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:28:38.569254877Z","updated_at":"2025-12-23T19:28:38.569254877Z"}
{"id":"HT-5m7","title":"MAJOR: Silent failure in DeviceService.setStorageItem()","description":"Lines 14-20: When localStorage fails (quota, private browsing), function silently fails. User preferences don't persist with no indication. Return boolean success status.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.827720285Z","updated_at":"2025-12-16T16:33:45.852375054Z","closed_at":"2025-12-16T16:33:45.852375054Z"}
{"id":"HT-da4","title":"CRITICAL: Incomplete data validation in dataService.ts","description":"Lines 85-94: validateExportData() checks arrays exist but NOT structure of individual items. Malformed habit/entry objects pass validation and cause runtime errors during import. Add field validation for each habit and entry object.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.882088279Z","updated_at":"2025-12-16T16:00:15.11758915Z","closed_at":"2025-12-16T16:00:15.11758915Z"}
{"id":"HT-k2n","title":"Tracker View: Render nested tag structure","description":"Update HabitTracker to display tags with nested children.\n\nFeatures:\n- Show tags with computed counts from descendants\n- Expand/collapse tag rows to show/hide children\n- Indent children under parent tags\n- Handle raw habits appearing under multiple tags","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T22:22:26.315078317Z","updated_at":"2025-12-13T22:48:01.127894752Z","closed_at":"2025-12-13T22:48:01.127894752Z","dependencies":[{"issue_id":"HT-k2n","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.65353614Z","created_by":"daemon"},{"issue_id":"HT-k2n","depends_on_id":"HT-7ic","type":"blocks","created_at":"2025-12-13T22:22:43.143286184Z","created_by":"daemon"}]}
{"id":"HT-hhb","title":"Phase 5: E2E tests for audio recording","description":"Playwright tests for recording flow and recordings page","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T22:19:20.20089181Z","updated_at":"2025-12-23T22:19:20.20089181Z","dependencies":[{"issue_id":"HT-hhb","depends_on_id":"HT-8ks","type":"parent-child","created_at":"2025-12-23T22:19:30.631413032Z","created_by":"daemon"}]}
{"id":"HT-ptb","title":"Data integrity: entryRepository.delete() silently succeeds when entry doesn't exist","description":"**File:** `src/repositories/entryRepository.ts:268-280`\n\n**Problem:** The `delete()` method calls `db.entries.delete()` without verifying the entry exists. Dexie's `delete()` doesn't throw when the record doesn't exist.\n\n**Impact:** Caller thinks delete succeeded when the entry never existed. This can mask bugs where the wrong ID is passed.\n\n**Fix:** Check if record exists before/after delete:\n```typescript\nasync delete(entryId: string): Promise\u003cvoid\u003e {\n  try {\n    const existing = await db.entries.get(entryId);\n    if (!existing) {\n      throw new Error(`Entry not found: ${entryId}`);\n    }\n    await db.entries.delete(entryId);\n  } catch (error) {\n    // ... error handling\n  }\n}\n```","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T19:28:03.154177065Z","updated_at":"2025-12-23T22:14:24.957226185Z","closed_at":"2025-12-23T22:14:24.957226185Z"}
{"id":"HT-f2y","title":"Migration: convert variantId entries to raw habit entries","description":"Create a migration that:\n1. Finds entries with variantId field\n2. Maps variantId to the new raw habit ID (from habit migration)\n3. Updates habitId to point to the raw habit\n4. Clears variantId/variantName fields\n\nEntries without variantId on variant habits:\n- Keep them on the (now tag) habit as generic entries\n- This is valid - tags can have direct entries","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T23:38:02.155168976Z","updated_at":"2025-12-13T23:54:04.754302293Z","closed_at":"2025-12-13T23:54:04.754302293Z","dependencies":[{"issue_id":"HT-f2y","depends_on_id":"HT-41t","type":"blocks","created_at":"2025-12-13T23:38:02.155811824Z","created_by":"daemon"},{"issue_id":"HT-f2y","depends_on_id":"HT-3rn","type":"blocks","created_at":"2025-12-13T23:38:38.696145822Z","created_by":"daemon"}]}
{"id":"HT-wja","title":"CRITICAL: Memory leak - uncleared setTimeout in HabitEditor.tsx","description":"Line 81: setTimeout for delete confirmation auto-reset is never cleared if component unmounts. Store timer in ref and clear in cleanup effect.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.649999006Z","updated_at":"2025-12-16T16:00:14.901930055Z","closed_at":"2025-12-16T16:00:14.901930055Z"}
{"id":"HT-z5f","title":"MAJOR: Silent failure in HabitSettings.tsx loadHabits()","description":"Lines 115-117: Loading habits failure only logged. User sees empty list with no explanation. Add error state and display message.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:36.39752742Z","updated_at":"2025-12-16T16:40:59.945728494Z","closed_at":"2025-12-16T16:40:59.945728494Z"}
{"id":"HT-sjq","title":"SyncLogService.addLog has potential race condition between add and enforceLimit","description":"**File:** `humane-tracker/src/services/syncLogService.ts:22-34`\n\nThe `addLog` method performs two operations:\n1. Add the log entry (line 24-31)\n2. Call `enforceLimit()` (line 34)\n\nWhile `enforceLimit()` correctly uses a transaction internally (lines 98-114), the add operation and cleanup are not in the same transaction. If multiple concurrent `addLog()` calls happen:\n\n1. Call A: adds log entry\n2. Call B: adds log entry  \n3. Call A: starts enforceLimit transaction\n4. Call B: starts enforceLimit transaction (blocked or separate)\n\nThis could result in more logs being deleted than intended, or the limit check seeing stale data.\n\n**Impact:** Low severity - worst case is slightly fewer logs than MAX_LOGS or slight over-deletion during high-frequency logging.\n\n**Fix:** Wrap both operations in a single transaction:\n```typescript\nawait this.syncLogsTable.db.transaction(\"rw\", this.syncLogsTable, async () =\u003e {\n  await this.syncLogsTable.add({...});\n  // inline enforceLimit logic here\n});\n```","status":"open","priority":4,"issue_type":"bug","created_at":"2025-12-23T19:28:32.827375169Z","updated_at":"2025-12-23T19:28:32.827375169Z"}
{"id":"HT-7ic","title":"Data Model: Add tag fields to Habit type","description":"Add habitType, childIds, parentIds fields to Habit interface and repository.\n\nFiles to modify:\n- src/types/habit.ts - Add fields to Habit interface\n- src/repositories/types.ts - Add fields to HabitRecord\n- src/config/db.ts - Bump schema version\n\nNew fields:\n- habitType: 'raw' | 'tag' (default 'raw')\n- childIds?: string[] (for tags: IDs of children)\n- parentIds?: string[] (for reverse lookup)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T22:22:25.295723065Z","updated_at":"2025-12-13T22:24:41.16001319Z","closed_at":"2025-12-13T22:24:41.16001319Z","dependencies":[{"issue_id":"HT-7ic","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.529408619Z","created_by":"daemon"}]}
{"id":"HT-28f","title":"Data integrity: habitRepository.update() silently succeeds when habit doesn't exist","description":"**File:** `src/repositories/habitRepository.ts:290`\n\n**Problem:** The `update()` method calls `db.habits.update()` but doesn't check if any records were updated. Dexie's `update()` returns 0 if the record doesn't exist - this is silently ignored.\n\nContrast with `entryRepository.updateValue()` (line 253-256) which correctly checks:\n```typescript\nconst updatedCount = await db.entries.update(entryId, { value });\nif (updatedCount === 0) {\n  throw new Error(`Entry not found: ${entryId}`);\n}\n```\n\n**Impact:** Caller thinks update succeeded when the habit doesn't exist. This can cause data inconsistency when callers expect the habit to be updated.\n\n**Fix:** Add the same pattern used in entryRepository:\n```typescript\nconst updatedCount = await db.habits.update(habitId, validatedUpdates);\nif (updatedCount === 0) {\n  throw new Error(`Habit not found: ${habitId}`);\n}\n```","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T19:28:03.11744549Z","updated_at":"2025-12-23T22:14:24.473501029Z","closed_at":"2025-12-23T22:14:24.473501029Z"}
{"id":"HT-4da","title":"Remove variant fields from Entry type","description":"Remove from src/types/habit.ts and src/repositories/types.ts:\n- variantId?: string\n- variantName?: string\n\nAlso remove from entryRepository.ts any variant handling code.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:38:02.682762816Z","updated_at":"2025-12-13T23:54:04.755152884Z","closed_at":"2025-12-13T23:54:04.755152884Z","dependencies":[{"issue_id":"HT-4da","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:21.969497308Z","created_by":"daemon"},{"issue_id":"HT-4da","depends_on_id":"HT-f2y","type":"blocks","created_at":"2025-12-13T23:38:38.808017663Z","created_by":"daemon"}]}
{"id":"HT-0xo","title":"MAJOR: Missing error path tests in habitRepository.ts","description":"Test file only tests validators. No tests for actual repository operations or error handling: create() error handling, update() with invalid updates, bulkDelete() transaction, subscribeByUserId() error callback.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:12.883934923Z","updated_at":"2025-12-16T15:37:12.883934923Z"}
{"id":"HT-41t","title":"Remove Variants - Replace with Tags","description":"Epic: Remove the embedded variants system and consolidate on tags.\n\nVariants and tags solve the same problem (grouping related activities). Tags are more flexible:\n- Each child has its own target\n- Children can belong to multiple tags\n- Cleaner mental model\n\nThis epic covers:\n1. Data migration (convert variant habits to tag + raw habits)\n2. Entry migration (variantId entries â†’ raw habit entries)\n3. Remove variant fields from types\n4. Remove VariantPicker component\n5. Clean up variant-related code","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T23:37:29.138517522Z","updated_at":"2025-12-13T23:54:10.85061972Z","closed_at":"2025-12-13T23:54:10.85061972Z"}
{"id":"HT-g3d","title":"CRITICAL: Custom date formatting in habitTreeUtils.ts violates conventions","description":"Lines 159-162: computeTagCounts uses custom date string format that doesn't pad months/days and uses 0-indexed months. Produces wrong date strings that won't match toDateString() format. Replace with toDateString() from types.ts.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.976325475Z","updated_at":"2025-12-16T16:00:15.216173999Z","closed_at":"2025-12-16T16:00:15.216173999Z"}
{"id":"HT-bgh","title":"MAJOR: Missing null/undefined check in habitValidation.ts","description":"Lines 21, 25: validateHabitForm will throw if data.name or data.category is undefined/null. Add defensive checks: if (!data.name || !data.name.trim()).","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.912482567Z","updated_at":"2025-12-16T16:34:50.986363919Z","closed_at":"2025-12-16T16:34:50.986363919Z"}
{"id":"HT-3xi","title":"Phase 3: Recording UI in AffirmationCard","description":"AudioRecorderButton component + integration into AffirmationCard","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T22:19:20.101010312Z","updated_at":"2025-12-23T22:30:11.416572052Z","closed_at":"2025-12-23T22:30:11.416572052Z","dependencies":[{"issue_id":"HT-3xi","depends_on_id":"HT-8ks","type":"parent-child","created_at":"2025-12-23T22:19:30.557506214Z","created_by":"daemon"}]}
{"id":"HT-3gn","title":"Data integrity: Orphaned entries when habit is deleted","description":"**File:** `src/repositories/habitRepository.ts:302-314` and `320-342`\n\n**Problem:** When a habit is deleted via `delete()` or `bulkDelete()`, there is no cascade to delete associated entries. The entries table will have orphaned records pointing to non-existent habitIds.\n\nSimilarly, when a tag habit is deleted, its `childIds` references from children's `parentIds` are not cleaned up.\n\n**Impact:**\n1. Orphaned entries waste storage space\n2. If habitId is reused (unlikely with UUIDs but possible), entries would incorrectly associate\n3. Export/import could include orphaned entries\n4. Tag system references become inconsistent\n\n**Fix Options:**\n1. Add cascade delete in a transaction:\n```typescript\nasync delete(habitId: string): Promise\u003cvoid\u003e {\n  await db.transaction(\"rw\", [db.habits, db.entries], async () =\u003e {\n    await db.entries.where(\"habitId\").equals(habitId).delete();\n    await db.habits.delete(habitId);\n  });\n}\n```\n2. Or document that callers must handle cascade themselves\n3. For tags: also clean up parentIds/childIds references","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:29:12.516412534Z","updated_at":"2025-12-23T19:29:12.516412534Z"}
{"id":"HT-zs3","title":"Performance: getForDateRange uses inefficient client-side filtering","description":"**File:** `src/repositories/entryRepository.ts:152-180`\n\n**Problem:** The `getForDateRange()` method filters by userId first, then uses `.and()` with a callback for date range filtering. The `.and()` callback runs client-side on ALL records matching userId.\n\n```typescript\nconst records = await db.entries\n  .where(\"userId\")\n  .equals(userId)\n  .and((record) =\u003e {\n    const dateStr = normalizeDateString(record.date as string | Date);\n    return dateStr \u003e= startStr \u0026\u0026 dateStr \u003c= endStr;\n  })\n  .toArray();\n```\n\n**Impact:** For users with many entries, this loads all entries into memory before filtering. If a user has 1000 entries but only needs 7 days, all 1000 are fetched.\n\n**Same pattern in:**\n- `getForHabitInRange()` (lines 182-210)\n- `subscribeForDateRange()` (lines 300-340)\n\n**Fix Options:**\n1. Create a compound index `[userId, date]` and use `.between()` for range queries\n2. Or create a compound index `[habitId, date]` for habit-specific queries\n3. The date is stored as YYYY-MM-DD string which sorts lexicographically, so range queries would work correctly","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T19:28:46.456485229Z","updated_at":"2025-12-23T19:28:46.456485229Z"}
{"id":"HT-2c5","title":"CRITICAL: Memory leak - uncleared setInterval in useVersionCheck.ts","description":"Lines 26-34: setInterval created but never cleared. Every mount/re-register creates new interval without clearing old one. Store interval ID in ref and clear on cleanup.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.757864452Z","updated_at":"2025-12-16T16:00:14.999518331Z","closed_at":"2025-12-16T16:00:14.999518331Z"}
{"id":"HT-oom","title":"Phase 4: Playback + /recordings page","description":"AudioPlayer component, RecordingsPage, add react-router-dom","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T22:19:20.143546637Z","updated_at":"2025-12-23T22:37:17.728457286Z","closed_at":"2025-12-23T22:37:17.728457286Z","dependencies":[{"issue_id":"HT-oom","depends_on_id":"HT-8ks","type":"parent-child","created_at":"2025-12-23T22:19:30.592673596Z","created_by":"daemon"}]}
{"id":"HT-cpb","title":"staleAuthUtils: isStuckState and related functions lack null safety","description":"**File:** humane-tracker/src/utils/staleAuthUtils.ts:24-64\n\n**Issue:** The `isStuckState` function at line 24 checks for exact string equality:\n```typescript\nreturn state.phase === \"initial\" \u0026\u0026 state.status === \"connected\";\n```\n\nBut the `SyncStateInfo` interface declares both fields as `string | null`. If either is `null`, the comparison works correctly (returns false), but there's no explicit handling of:\n1. `undefined` passed as state\n2. State object missing properties entirely\n\n**Edge cases not explicitly handled:**\n- `isStuckState(undefined as any)` - would throw\n- `isStuckState({} as SyncStateInfo)` - would return false (acceptable)\n- `isStuckState({ phase: undefined, status: undefined } as any)` - would return false\n\n**Recommendation:** Add defensive check at function start:\n```typescript\nif (!state) return false;\n```","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:29:04.982694266Z","updated_at":"2025-12-23T19:29:04.982694266Z"}
{"id":"HT-5m9","title":"MAJOR: habitType/childIds relationship not expressed in types","description":"Relationship between habitType and childIds/parentIds is implicit. A tag without childIds or raw habit with childIds type-checks fine. Consider discriminated union for tag vs raw habits.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:12.722399215Z","updated_at":"2025-12-16T15:37:12.722399215Z"}
{"id":"HT-psv","title":"CRITICAL: Missing unit tests for authUtils.ts","description":"No tests for authentication utilities. Handles data detection, destruction during sign-in, and sign-in flow orchestration. Auth bugs could cause permanent data loss. Need tests for all scenarios.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:35:56.045329101Z","updated_at":"2025-12-16T16:24:46.103825146Z","closed_at":"2025-12-16T16:24:46.103825146Z"}
{"id":"HT-5up","title":"tagUtils: repairTagRelationships doesn't remove orphaned references to deleted habits","description":"**File:** humane-tracker/src/utils/tagUtils.ts:26-111\n\n**Issue:** The `repairTagRelationships` function adds missing bidirectional links but doesn't REMOVE references to habits that no longer exist.\n\nExample: If habit H1 has `parentIds: [\"deleted-tag-id\"]` where the tag was deleted:\n- The function will NOT remove \"deleted-tag-id\" from H1's parentIds\n- This leaves orphaned references in the data\n\n**Lines affected:** 62-104 - the repair loop only adds, never removes\n\n**Recommendation:** Add a cleanup step that removes references to non-existent habits:\n```typescript\n// Remove orphaned parentIds\nnewParentIds = newParentIds.filter(pid =\u003e habitMap.has(pid));\n// Remove orphaned childIds  \nnewChildIds = newChildIds.filter(cid =\u003e habitMap.has(cid));\n```","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:29:04.89476033Z","updated_at":"2025-12-23T22:19:17.001210894Z","closed_at":"2025-12-23T22:19:17.001210894Z"}
{"id":"HT-7i5","title":"Race condition in useHabitTrackerVM loadHabits","description":"File: humane-tracker/src/hooks/useHabitTrackerVM.ts\n\nThe `loadHabits` function (lines 288-321) can be called concurrently from multiple subscription callbacks without any protection against concurrent execution.\n\nWhen `subscribeToHabits` and `subscribeToWeekEntries` both fire (lines 333-351), they both call `loadHabits(true)`. If these fire in quick succession, multiple async operations will be in-flight simultaneously, potentially causing:\n- State updates in unpredictable order\n- Stale data overwriting fresh data\n- Unnecessary database queries\n\nFix: Add an abort controller or a ref-based guard (like `isLoadingRef`) to cancel/skip concurrent loads.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:28:15.486206588Z","updated_at":"2025-12-23T19:28:15.486206588Z"}
{"id":"HT-2gd","title":"Replace index-based keys with stable identifiers in list renders","description":"Using array index as React key can cause issues with component state when items are reordered or removed.\n\nAffected files:\n- CleanupDuplicates.tsx:155-158 - Uses idx as key for duplicatesFound list:\n  `{duplicatesFound.map((dup, idx) =\u003e (\n    \u003cdiv key={idx} ...\u003e`\n\nThe duplicatesFound array contains unique strings like \"HabitName (X copies)\" which could be used as keys directly:\n  `{duplicatesFound.map((dup) =\u003e (\n    \u003cdiv key={dup} ...\u003e`\n\nThis is a minor issue since the list is display-only and won't be reordered, but it's still best practice to use stable identifiers.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:29:25.83896336Z","updated_at":"2025-12-23T19:29:25.83896336Z"}
{"id":"HT-prs","title":"Update spec: mark variants as deprecated","description":"Update TAG-HABITS-SPEC.md to:\n- Mark variants as deprecated/removed\n- Clarify tags replace variants entirely\n- Update Phase 5 to reflect current work\n- Remove any references to keeping both systems","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T23:38:01.644721663Z","updated_at":"2025-12-13T23:47:53.148828639Z","closed_at":"2025-12-13T23:47:53.148828639Z","dependencies":[{"issue_id":"HT-prs","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:21.678267974Z","created_by":"daemon"}]}
{"id":"HT-6rk","title":"Transaction handling: runImportTransaction doesn't prevent nested transactions","description":"**File:** `src/repositories/transactions.ts:14-39`\n\n**Problem:** The `runImportTransaction()` wraps repository calls in a transaction, but the repository methods it calls (`habitRepository.clear()`, `entryRepository.clear()`, etc.) don't know they're inside a transaction. \n\nThis works NOW because the repository methods don't start their own transactions, but it's fragile:\n1. If someone adds a transaction inside a repository method, Dexie will handle nested transactions but behavior may be unexpected\n2. The repository methods log \"DESTRUCTIVE\" warnings that might confuse users since the outer transaction could still rollback\n\n**More concerning:** If any repository method were to throw during the transaction, the error is NOT caught at the transaction level - it bubbles up. This is correct behavior, but there's no explicit documentation or handling.\n\n**Recommendations:**\n1. Add JSDoc warning that repository methods called here must NOT start their own transactions\n2. Consider adding try/catch at transaction level with explicit rollback logging\n3. Consider passing a transaction context to repository methods so they know they're in a transaction","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:28:46.523171497Z","updated_at":"2025-12-23T19:28:46.523171497Z"}
{"id":"HT-1hm","title":"authUtils: handleSignIn swallows error context when localData exists but onPromptNeeded is undefined","description":"**File:** humane-tracker/src/utils/authUtils.ts:61-88\n\n**Issue:** When `localData` exists but `onPromptNeeded` is not provided, the function proceeds to `db.cloud.login()` without giving the user any choice about their data. This is a silent failure to prompt.\n\nThe conditional at line 67 is `if (localData \u0026\u0026 onPromptNeeded)` - if `onPromptNeeded` is undefined, local data is silently merged without user consent.\n\n**Recommendation:** Either:\n1. Require `onPromptNeeded` in the function signature (not optional)\n2. Default to a safe behavior (e.g., cancel if can't prompt)\n3. Add a log warning when prompting is skipped","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:29:04.76171113Z","updated_at":"2025-12-23T19:29:04.76171113Z"}
{"id":"HT-bld","title":"Add keyboard navigation (focus trap, Escape) to dialogs missing it","description":"Some dialogs are missing proper keyboard navigation handlers. Best practice for modal dialogs includes:\n1. Focus trap (Tab cycles within dialog, not to page behind)\n2. Escape key closes dialog\n3. Initial focus on first focusable element\n\nMissing Escape key handler:\n- SignInDialog.tsx - No keyboard handler at all\n- InitializeHabits.tsx - No keyboard handler\n\nGood examples in codebase:\n- UserMenu.tsx:64-77 - Properly handles Escape key\n- TagChildPicker.tsx:42-50 - Properly handles Escape key\n- BugReportDialog.tsx - Should be checked for Escape handling\n\nNote: Focus trap is more complex and may require a library like @radix-ui/react-focus-scope or custom implementation. Consider adding a shared DialogWrapper component that handles these concerns consistently.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T19:29:25.354080998Z","updated_at":"2025-12-23T19:29:25.354080998Z"}
{"id":"HT-qjz","title":"Service worker uses skipWaiting which can cause inconsistent state","description":"In sw.ts (lines 33-39), the service worker immediately activates and claims all clients:\n\n```typescript\nself.addEventListener(\"install\", () =\u003e {\n  self.skipWaiting();\n});\n\nself.addEventListener(\"activate\", (event) =\u003e {\n  event.waitUntil(self.clients.claim());\n});\n```\n\nThis is a potentially dangerous pattern for data-intensive PWAs:\n1. skipWaiting() causes the new SW to activate immediately during page use\n2. clients.claim() takes over all tabs without page reload\n3. If the new SW has breaking changes to caching or sync logic, existing tabs may behave inconsistently\n\nFor a local-first app with Dexie Cloud sync, this can cause data race conditions between old and new SW versions.\n\nConsider either:\n- Removing skipWaiting() and prompting users to reload\n- Or adding version tracking to ensure data compatibility before takeover","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:28:38.648503653Z","updated_at":"2025-12-23T19:28:38.648503653Z"}
{"id":"HT-e1z","title":"MINOR: Subscription error handler returns empty array","description":"entryRepository.ts:322-324 and habitRepository.ts:391-393: When subscription errors, callback([]) called which could overwrite valid cached data. Consider letting UI handle errors instead.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T15:37:36.809131267Z","updated_at":"2025-12-16T15:37:36.809131267Z"}
{"id":"HT-9br","title":"Remove addEntryWithVariant from VM","description":"In useHabitTrackerVM.ts:\n- Remove addEntryWithVariant method\n- Clean up any variant-related logic\n\nThe TagChildPicker handles child selection differently - entries go to child habits directly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:38:03.165320224Z","updated_at":"2025-12-13T23:54:04.756239352Z","closed_at":"2025-12-13T23:54:04.756239352Z","dependencies":[{"issue_id":"HT-9br","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:22.047691935Z","created_by":"daemon"},{"issue_id":"HT-9br","depends_on_id":"HT-4jf","type":"blocks","created_at":"2025-12-13T23:38:38.885809706Z","created_by":"daemon"}]}
{"id":"HT-aaq","title":"Missing input validation: userId parameter not validated in repository methods","description":"**Files:**\n- `src/repositories/entryRepository.ts` - getByUserId, countByUserId, deleteByUserId, getForDateRange, subscribeForDateRange, subscribeByUserId\n- `src/repositories/habitRepository.ts` - getByUserId, countByUserId, deleteByUserId, subscribeByUserId\n- `src/repositories/affirmationLogRepository.ts` - getByUserId, getByUserIdAndDate\n\n**Problem:** The userId parameter is not validated before use. While Dexie won't crash on empty/null userId, it leads to incorrect queries:\n- Empty string userId will query for entries with empty userId\n- Undefined/null would cause Dexie errors\n\n**Note:** `affirmationLogRepository.validateAffirmationLog()` validates userId for creates, but read operations don't validate.\n\n**Consistency issue:** The repositories validate some inputs (habit name, category, entry value) but not others (userId, habitId).\n\n**Fix:** Add validation helper and use consistently:\n```typescript\nfunction validateUserId(userId: string): void {\n  if (!userId || typeof userId !== \"string\" || !userId.trim()) {\n    throw new Error(\"Invalid userId: cannot be empty\");\n  }\n}\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:28:46.583154821Z","updated_at":"2025-12-23T19:28:46.583154821Z"}
{"id":"HT-ntp","title":"Add missing aria-labels to close buttons in dialogs","description":"Multiple dialog close buttons are missing aria-label attributes for screen reader accessibility.\n\nAffected files:\n- DebugLogsDialog.tsx:141 - Close button uses \"X\" text without aria-label\n- SyncStatusDialog.tsx:229 - Close button uses \"X\" text without aria-label\n- HabitEditor.tsx:118 - Close button uses \"X\" text without aria-label\n- HabitManager.tsx:61 - Close button uses \"x\" text without aria-label\n- HabitSettings.tsx:387-405 - Multiple close buttons without aria-labels\n- TagChildPicker.tsx:87 - Close button uses \"x\" text without aria-label\n\nAll close buttons should have aria-label=\"Close\" or aria-label=\"Close dialog\" for accessibility compliance.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T19:29:24.561437901Z","updated_at":"2025-12-23T22:22:42.315110328Z","closed_at":"2025-12-23T22:22:42.315110328Z"}
{"id":"HT-q2m","title":"MINOR: Magic numbers in useShakeDetector.ts","description":"Lines 31-32: threshold=25 and cooldownMs=2000 are magic numbers. Extract to named constants for maintainability.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T15:37:36.644976196Z","updated_at":"2025-12-16T16:44:02.127061718Z","closed_at":"2025-12-16T16:44:02.127061718Z"}
{"id":"HT-8rk","title":"HabitEntry.value comment says 0.5 for partial but EntryValue allows any non-negative","description":"In types/habit.ts (line 42), the HabitEntry interface documents value as:\n\n```typescript\nvalue: number; // 0 (not done), 0.5 (partial), 1 (done), or count for sets\n```\n\nBut the actual EntryValue type in repositories/types.ts (line 53) is just `number`, with runtime validation in validateEntryValue() that allows 0, 0.5, or any non-negative integer.\n\nThe domain type HabitEntry.value is typed as plain `number` but should use EntryValue for type-level documentation. Additionally, HabitEntry should be aligned with EntryRecord from repositories/types.ts to avoid the same Date vs string confusion.\n\nThis is a documentation/type maintenance issue that could cause confusion when developers work with these types.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:28:38.709594523Z","updated_at":"2025-12-23T19:28:38.709594523Z"}
{"id":"HT-cyo","title":"Memory allocation on every render in useHabitTrackerVM","description":"File: humane-tracker/src/hooks/useHabitTrackerVM.ts:504\n\n```typescript\nexpandedTags: new Set(expandedTagsRef.current) as ReadonlySet\u003cstring\u003e,\n```\n\nThis creates a new Set on every render, which:\n1. Causes unnecessary memory allocation\n2. Creates a new object identity each render, potentially causing downstream re-renders if consumers use reference equality\n\nFix: Memoize the Set creation, updating only when `expandedTagsVersion` changes.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:28:15.533673686Z","updated_at":"2025-12-23T19:28:15.533673686Z"}
{"id":"HT-7aw","title":"Error handling: Subscription error handlers call callback with empty array","description":"**Files:**\n- `src/repositories/entryRepository.ts:321-336` - `subscribeForDateRange()`\n- `src/repositories/entryRepository.ts:351-367` - `subscribeByUserId()`\n- `src/repositories/habitRepository.ts:387-400` - `subscribeByUserId()`\n\n**Problem:** When a subscription error occurs, the code:\n1. Logs the error\n2. Calls optional `onError` callback\n3. ALSO calls the success `callback([])` with empty array\n\n```typescript\nerror: (error) =\u003e {\n  console.error(\"...\", error);\n  if (onError) {\n    onError(error);\n  }\n  callback([]);  // \u003c-- This is problematic\n}\n```\n\n**Issues:**\n1. Calling `callback([])` after an error could cause UI to show \"no data\" instead of \"error\"\n2. UI might flash between error state and empty state\n3. If `onError` already handles the error, calling `callback([])` duplicates handling\n\n**Recommendation:**\n1. DON'T call `callback([])` after error - let UI decide how to handle\n2. OR make it clear this is a \"fallback to empty\" behavior by documenting it\n3. Consider: should subscriptions even continue after error, or should they terminate?","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:29:12.572926719Z","updated_at":"2025-12-23T19:29:12.572926719Z"}
{"id":"HT-09r","title":"MAJOR: Missing input validation in affirmationLogRepository.create()","description":"Lines 43-59: create() performs no validation unlike habitRepository which validates name, category, targetPerWeek. Validate userId (not empty), affirmationTitle (not empty), logType (valid enum).","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.591045989Z","updated_at":"2025-12-16T16:33:00.192859767Z","closed_at":"2025-12-16T16:33:00.192859767Z"}
{"id":"HT-0ou","title":"MAJOR: HabitWithStatus.currentWeekCount can be inconsistent with entries","description":"currentWeekCount and entries can become inconsistent - nothing prevents setting them independently. Consider making currentWeekCount computed via helper function instead of stored field.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:12.789149112Z","updated_at":"2025-12-16T15:37:12.789149112Z"}
{"id":"HT-d78","title":"MAJOR: Missing update verification in entryRepository.updateValue()","description":"Lines 242-254: updateValue() doesn't verify entry exists before updating. Dexie's update() returns 0 silently if record doesn't exist. Check return value and throw if entry not found.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.639371876Z","updated_at":"2025-12-16T16:32:25.837534773Z","closed_at":"2025-12-16T16:32:25.837534773Z"}
{"id":"HT-8ks","title":"Audio recording for affirmations","description":"Add audio recording capability to AffirmationCard with offline-first storage and /recordings page","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-23T22:19:04.346114879Z","updated_at":"2025-12-23T22:19:04.346114879Z"}
{"id":"HT-yyo","title":"useVersionCheck serviceWorkerAvailable reads stale ref value during render","description":"File: humane-tracker/src/hooks/useVersionCheck.ts:91\n\n```typescript\nserviceWorkerAvailable: registrationRef.current !== null,\n```\n\nThis reads from a ref during render to compute a return value. The problem is:\n1. When `onRegisteredSW` callback fires and sets `registrationRef.current`, this doesn't trigger a re-render\n2. Consumers will see `serviceWorkerAvailable: false` even after the service worker is registered, until some other state change causes a re-render\n\nFix: Add a `useState` for `serviceWorkerAvailable` and update it in the `onRegisteredSW` callback.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:28:15.617423482Z","updated_at":"2025-12-23T19:28:15.617423482Z"}
{"id":"HT-123","title":"SyncLog.timestamp type mismatch: Date in interface but stored as ISO string","description":"In types/syncLog.ts (line 12), the SyncLog interface defines timestamp as Date:\n\n```typescript\nexport interface SyncLog {\n  id: string;\n  timestamp: Date;  // Date type\n  // ...\n}\n```\n\nBut in config/syncLogDB.ts, the database stores it as an indexed string field, and the SyncLogService likely stores ISO strings. The SyncLogDB schema at line 14 indexes timestamp, which requires string serialization for IndexedDB.\n\nThe service that writes to this table needs to convert Date to string before storage, but the type doesn't reflect this. This creates the same Date/string confusion that led to historic bugs in the main database.\n\nShould align the type with actual storage format (string) and update the service accordingly.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:28:38.623010426Z","updated_at":"2025-12-23T19:28:38.623010426Z"}
{"id":"HT-74r","title":"MINOR: Magic numbers in habitRepository.ts validateTargetPerWeek","description":"Lines 33-53: Min/max/default values (1, 7, 3) are hardcoded. Extract to TARGET_PER_WEEK_MIN, TARGET_PER_WEEK_MAX, TARGET_PER_WEEK_DEFAULT constants.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-16T15:37:36.693102006Z","updated_at":"2025-12-16T16:44:02.035290721Z","closed_at":"2025-12-16T16:44:02.035290721Z"}
{"id":"HT-a0p","title":"CRITICAL: Silent failure in clearLocalAnonymousData() swallows deletion errors","description":"authUtils.ts:47-49: When user chooses \"abandon\" data during sign-in, deletion errors are silently swallowed. User proceeds thinking data was cleared but it may still exist causing conflicts.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:55.872426985Z","updated_at":"2025-12-16T16:03:46.992171871Z","closed_at":"2025-12-16T16:03:46.992171871Z"}
{"id":"HT-3rn","title":"Migration: convert variant habits to tag + raw habits","description":"Create a migration that:\n1. Finds habits with variants[] array\n2. For each variant, creates a new raw habit\n3. Converts parent habit to a tag with childIds pointing to new raw habits\n4. Sets parentIds on the new raw habits\n\nExample:\nBefore: Shoulder Accessory { variants: [Shoulder Y, Wall Slide] }\nAfter: \n- Shoulder Accessory (tag) { childIds: [id1, id2] }\n- Shoulder Y (raw) { parentIds: [shoulder-accessory-id] }\n- Wall Slide (raw) { parentIds: [shoulder-accessory-id] }","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T23:38:01.884206534Z","updated_at":"2025-12-13T23:54:04.752823364Z","closed_at":"2025-12-13T23:54:04.752823364Z","dependencies":[{"issue_id":"HT-3rn","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:21.721526447Z","created_by":"daemon"}]}
{"id":"HT-0g4","title":"Wrap import/replace in Dexie transaction for atomicity","description":"**Severity: Critical**\n\nThe `importAllData()` function in `dataService.ts` performs 4 separate async operations without a transaction wrapper:\n\n```typescript\nif (mode === \"replace\") {\n  await habitRepository.clear();   // Op 1\n  await entryRepository.clear();   // Op 2\n}\nawait habitRepository.bulkPut(habits);   // Op 3\nawait entryRepository.bulkPut(entries);  // Op 4\n```\n\n## Problem\n- Between each step, LiveQuery subscriptions fire and UI sees inconsistent state\n- If error occurs mid-operation (e.g., after clear but before bulkPut), data is lost with no rollback\n- Cloud sync could be pushing/pulling simultaneously, causing merge conflicts\n- Violates Dexie Cloud's atomicity guarantees\n\n## Solution\nWrap in `db.transaction()`:\n\n```typescript\nimport { db } from \"../config/db\";\n\nreturn db.transaction('rw', db.habits, db.entries, async () =\u003e {\n  if (mode === \"replace\") {\n    await db.habits.clear();\n    await db.entries.clear();\n  }\n  await db.habits.bulkPut(habitsRecords);\n  await db.entries.bulkPut(entriesRecords);\n});\n```\n\n## Reference\nhttps://dexie.org/docs/cloud/consistency\n\u003e \"Any Dexie transaction will be regarded as an atomic all-or-nothing operation when it syncs to the cloud.\"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T14:17:40.317568536Z","updated_at":"2025-12-13T14:53:27.38201373Z","closed_at":"2025-12-13T14:53:27.38201373Z","dependencies":[{"issue_id":"HT-0g4","depends_on_id":"HT-er4","type":"parent-child","created_at":"2025-12-13T14:17:47.069925935Z","created_by":"daemon"}]}
{"id":"HT-906","title":"CRITICAL: Missing error handling in affirmationLogRepository.ts","description":"Lines 42-98: Zero try-catch error handling on any database operations unlike entryRepository and habitRepository. All methods need error handling: create(), getAll(), clear(), bulkPut(), getByUserIdAndDate(), getByUserId().","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.841269533Z","updated_at":"2025-12-16T16:00:15.074454164Z","closed_at":"2025-12-16T16:00:15.074454164Z"}
{"id":"HT-c1x","title":"SyncLogService.addLog silently swallows non-quota errors","description":"**File:** `humane-tracker/src/services/syncLogService.ts:51-53`\n\nIn `addLog()`, non-quota errors are caught, logged to console, and swallowed:\n```typescript\n// Other errors: silently fail - don't break the app if logging fails\nconsole.error(\"Failed to add sync log:\", error);\n```\n\nThe comment explains the reasoning (don't break the app), but this makes debugging difficult since sync issues are invisible to users and only visible in browser console.\n\n**Impact:** If sync logging consistently fails (e.g., due to DB corruption), developers/users have no visibility into why sync diagnostics are empty.\n\n**Suggested improvement:** Track failure count and surface to diagnostics UI after N consecutive failures, or emit a metric/event that the diagnostics page can show.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T19:28:32.799426695Z","updated_at":"2025-12-23T19:28:32.799426695Z"}
{"id":"HT-asd","title":"MAJOR: useEffect missing loadHabits dependency in HabitSettings.tsx","description":"Lines 90-92: useEffect depends on userId but calls loadHabits() which is not in dependency array. Wrap loadHabits in useCallback and add to deps, or inline the logic.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:19.083958435Z","updated_at":"2025-12-16T16:31:42.69639891Z","closed_at":"2025-12-16T16:31:42.69639891Z"}
{"id":"HT-ffn","title":"MAJOR: Missing error UI feedback in HabitManager.tsx","description":"Lines 48-52: Catch block logs error but shows no user feedback. Add setError(\"Failed to create habit. Please try again.\") to inform user.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:18.829515714Z","updated_at":"2025-12-16T16:28:24.074595551Z","closed_at":"2025-12-16T16:28:24.074595551Z"}
{"id":"HT-e5w","title":"CRITICAL: Date handling inconsistency in affirmationLogRepository.ts","description":"Lines 25-27: Uses raw new Date() instead of normalizeDate/fromDateString helpers. Other repos use normalizeDate() correctly. Can produce incorrect results due to timezone interpretation.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.798435239Z","updated_at":"2025-12-16T16:00:15.040326371Z","closed_at":"2025-12-16T16:00:15.040326371Z"}
{"id":"HT-pma","title":"MAJOR: Silent failure in HabitSettings.tsx handleSaveAll()","description":"Lines 229-231: When saving habit changes fails, error logged but dialog closes anyway (onClose() not prevented). User thinks save succeeded. Keep dialog open on error.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:36.324179327Z","updated_at":"2025-12-16T16:40:59.997334978Z","closed_at":"2025-12-16T16:40:59.997334978Z"}
{"id":"HT-4xc","title":"Use update() instead of put() for single-property modifications","description":"**Severity: High**\n\nRepositories currently use `bulkPut()` which replaces entire objects. When two devices modify different properties of the same habit concurrently, last-write-wins means one change is lost.\n\n## Problem\nDevice A changes habit name, Device B changes targetPerWeek. With put(), whichever syncs last overwrites the other's change entirely.\n\n## Current Code\n```typescript\n// habitRepository.ts\nasync update(habit: Habit): Promise\u003cvoid\u003e {\n  await db.habits.put(toRecord(habit));  // Replaces entire object\n}\n```\n\n## Solution\nFor operations that modify specific fields, use `Table.update()`:\n\n```typescript\n// For targeted updates\nasync updateField(id: string, changes: Partial\u003cHabitRecord\u003e): Promise\u003cvoid\u003e {\n  await db.habits.update(id, changes);\n}\n\n// Usage\nawait habitRepository.updateField(habitId, { name: newName });\nawait habitRepository.updateField(habitId, { targetPerWeek: 5 });\n```\n\n## Scope\nIdentify all places where we modify a single property and could use update() instead:\n- Habit name changes\n- Habit category changes  \n- Habit targetPerWeek changes\n- Entry value changes (toggles)\n\n## Reference\nhttps://dexie.org/docs/cloud/best-practices\n\u003e \"Update operations manipulate individual properties rather than replacing entire objects, which prevents conflicts when two different clients mutate different properties on the same object.\"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T14:17:40.648215941Z","updated_at":"2025-12-13T15:02:52.631953139Z","closed_at":"2025-12-13T15:02:52.631953139Z","dependencies":[{"issue_id":"HT-4xc","depends_on_id":"HT-er4","type":"parent-child","created_at":"2025-12-13T14:17:47.210925523Z","created_by":"daemon"}]}
{"id":"HT-3po","title":"Remove unused userId parameter from HabitEditor component","description":"HabitEditor.tsx accepts a userId prop that is never used in the component.\n\nFile: HabitEditor.tsx\nLine 13: userId: string is in the interface\nLine 31-36: userId is destructured but never referenced in the component body\n\nThe habit service operations don't require userId since they work with the habit ID directly.\n\nFix: Remove userId from HabitEditorProps interface and from the destructuring.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:29:25.721737306Z","updated_at":"2025-12-23T19:29:25.721737306Z"}
{"id":"HT-iz1","title":"categoryUtils: extractCategories doesn't handle undefined/null category","description":"**File:** humane-tracker/src/utils/categoryUtils.ts:62-77\n\n**Issue:** The `extractCategories` function assumes all habits have a defined `category` property. If a habit has `category: undefined` or `category: null`, the function will:\n1. Add `undefined` or `null` to the Set\n2. Push it to the categories array\n\nThis could cause issues downstream when rendering or comparing categories.\n\n**Edge case not handled:** Empty array input returns empty array (fine), but habits with missing/undefined categories are not filtered out.\n\n**Recommendation:** Filter out falsy categories or normalize them to a default value (e.g., \"Uncategorized\").","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:29:04.653500029Z","updated_at":"2025-12-23T22:19:16.783244819Z","closed_at":"2025-12-23T22:19:16.783244819Z"}
{"id":"HT-2lg","title":"Silent failure: handleSignIn promise result ignored in App.tsx","description":"In App.tsx:45-47, the handleSignInWithPrompt callback calls handleSignIn(promptForSignInChoice) but ignores the returned promise. If handleSignIn throws an error, it will be unhandled. This violates the rule against silent failures.\n\nFile: humane-tracker/src/App.tsx:45-47\n```typescript\nconst handleSignInWithPrompt = useCallback(() =\u003e {\n  handleSignIn(promptForSignInChoice);  // Promise not awaited/caught\n}, [promptForSignInChoice]);\n```\n\nShould either await and handle errors, or use .catch() to log failures.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:28:38.503992782Z","updated_at":"2025-12-23T22:19:16.950276471Z","closed_at":"2025-12-23T22:19:16.950276471Z"}
{"id":"HT-5yq","title":"CRITICAL: Silent failure in handleSignIn() swallows login errors","description":"authUtils.ts:79-81: Catch block only logs to console. User has NO indication sign-in failed. Could hide network issues, Dexie Cloud outages, invalid tokens. Return error status so caller can display to user.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:55.824994351Z","updated_at":"2025-12-16T16:00:15.284980186Z","closed_at":"2025-12-16T16:00:15.284980186Z"}
{"id":"HT-asl","title":"Data Model: Add notes/sets fields to Entry type","description":"Add write-loose-structure-later fields to HabitEntry.\n\nFiles to modify:\n- src/types/habit.ts - Add SetData interface, add fields to HabitEntry\n- src/repositories/types.ts - Add fields to EntryRecord\n\nNew types/fields:\n- SetData: { weight?, reps?, duration? }\n- notes?: string (freeform entry)\n- sets?: SetData[] (structured data)\n- parsed?: boolean (LLM processed flag)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T22:22:25.546302596Z","updated_at":"2025-12-13T22:24:46.311219874Z","closed_at":"2025-12-13T22:24:46.311219874Z","dependencies":[{"issue_id":"HT-asl","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.563048273Z","created_by":"daemon"}]}
{"id":"HT-644","title":"Data integrity: deleteByUserId could partially fail leaving orphans","description":"**Files:**\n- `src/repositories/entryRepository.ts:115-132` - `deleteByUserId()`\n- `src/repositories/habitRepository.ts:175-192` - `deleteByUserId()`\n\n**Problem:** These methods count records first, then delete, without a transaction:\n```typescript\nconst count = await db.entries.where(\"userId\").equals(userId).count();\nawait db.entries.where(\"userId\").equals(userId).delete();\n```\n\n**Issues:**\n1. Race condition: records could be added between count and delete\n2. No transaction: if delete fails partway, some records are deleted and some aren't\n3. The returned count may not match what was actually deleted\n\n**Impact:** Inconsistent data state during user data cleanup. The count returned is unreliable.\n\n**Fix:** Wrap in a transaction and get count from delete result:\n```typescript\nasync deleteByUserId(userId: string): Promise\u003cnumber\u003e {\n  return await db.transaction(\"rw\", db.entries, async () =\u003e {\n    const count = await db.entries.where(\"userId\").equals(userId).delete();\n    return count;\n  });\n}\n```\nNote: Dexie's `.delete()` on a Collection returns the count of deleted records.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:28:46.493738171Z","updated_at":"2025-12-23T22:19:17.049058557Z","closed_at":"2025-12-23T22:19:17.049058557Z"}
{"id":"HT-4fl","title":"MAJOR: Silent failures in SyncSection.tsx operations","description":"Lines 233-234, 251-253, 262-264, 271-273: Multiple async operations (Sync Now, etc.) catch errors and only log. User clicks buttons, nothing happens, no feedback. Show toast/alert for each failure.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:36.463005406Z","updated_at":"2025-12-16T16:41:52.910164049Z","closed_at":"2025-12-16T16:41:52.910164049Z"}
{"id":"HT-zpb","title":"MAJOR: Missing getNextEntryValue tag mode tests","description":"useHabitTrackerVM.test.ts: getNextEntryValue tests only cover raw habits. Missing tests for tag toggle behavior: null to 1, 1 to null, any positive to null.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T15:37:36.527084555Z","updated_at":"2025-12-16T15:37:36.527084555Z"}
{"id":"HT-7yv","title":"authUtils: clearLocalAnonymousData is not exported but could fail silently","description":"**File:** humane-tracker/src/utils/authUtils.ts:37-47\n\n**Issue:** The `clearLocalAnonymousData` function has a JSDoc saying `@throws Error if data clearing fails - caller must handle`, but:\n\n1. The function doesn't actually throw - it awaits repository calls that might throw\n2. The caller `handleSignIn` catches all errors at line 82, so any failure in `clearLocalAnonymousData` is logged but the user gets a generic \"Sign-in failed\" message\n3. If `entryRepository.deleteByUserId` fails but `habitRepository.deleteByUserId` would succeed, the data is left in an inconsistent state\n\n**Recommendation:** \n- Wrap both deletions in a try-catch and handle partial failure\n- Consider using a transaction if the repository supports it\n- Return more specific error messages to the user","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:29:04.733858976Z","updated_at":"2025-12-23T19:29:04.733858976Z"}
{"id":"HT-9nj","title":"Consider memoizing expensive computations in HabitSettings component","description":"HabitSettings.tsx is a large component with potentially expensive operations that re-run on every render:\n\n1. Line 78: existingCategories computed on every render\n   `const existingCategories = extractCategories(habits);`\n\n2. Lines 81-90: habitsByCategory computed on every render\n   `const habitsByCategory = existingCategories.reduce(...)`\n\n3. Lines 348-350: habitsNeedingMigration filtered on every render\n   `const habitsNeedingMigration = habits.filter(...)`\n\nThese could be wrapped in useMemo to avoid recomputation when unrelated state changes (like UI toggles):\n\n```tsx\nconst existingCategories = useMemo(() =\u003e extractCategories(habits), [habits]);\nconst habitsByCategory = useMemo(() =\u003e {...}, [habits, existingCategories]);\nconst habitsNeedingMigration = useMemo(() =\u003e {...}, [habits]);\n```\n\nPriority is low because the habit list is typically small (\u003c50 items), but this becomes a performance concern at scale.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:29:26.890727163Z","updated_at":"2025-12-23T19:29:26.890727163Z"}
{"id":"HT-hg6","title":"dataService uses unsafe type assertions for date parsing","description":"**File:** `humane-tracker/src/services/dataService.ts:47-48, 63-64, 71-72`\n\nThe import function uses `as unknown as string` type assertions when parsing dates:\n```typescript\ncreatedAt: normalizeDate(h.createdAt as unknown as string),\nupdatedAt: normalizeDate(h.updatedAt as unknown as string),\n```\n\nWhile `normalizeDate` will throw on invalid input, the error message won't be helpful for debugging (e.g., \"Invalid date for habit ID xyz\"). \n\n**Impact:** If an import file has corrupted date data, the user will see a generic error with no indication of which record failed.\n\n**Fix:** Wrap date normalization with try-catch that includes context:\n```typescript\ntry {\n  normalizeDate(h.createdAt as unknown as string)\n} catch (e) {\n  throw new Error(`Invalid createdAt date for habit \"${h.name || h.id}\": ${h.createdAt}`)\n}\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:28:32.715292481Z","updated_at":"2025-12-23T19:28:32.715292481Z"}
{"id":"HT-2ts","title":"MAJOR: TypeScript any type in HabitEditor.tsx and HabitSettings.tsx","description":"HabitEditor.tsx:166 and HabitSettings.tsx:122,692 use 'as any' for tracking type. Replace with proper type: \"binary\" | \"sets\" | \"hybrid\".","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:18.980959185Z","updated_at":"2025-12-16T16:30:53.951867278Z","closed_at":"2025-12-16T16:30:53.951867278Z"}
{"id":"HT-flt","title":"CRITICAL: Silent failure in handleSignOut() swallows logout errors","description":"App.tsx:84-86: Sign-out errors silently swallowed. User may think they logged out (for security on shared device) but session still active. Show error message.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:55.960076067Z","updated_at":"2025-12-16T16:03:47.046780839Z","closed_at":"2025-12-16T16:03:47.046780839Z"}
{"id":"HT-bea","title":"Type safety: Unsafe type assertion in toRecord and toEntry","description":"**Files:**\n- `src/repositories/entryRepository.ts:23,26` - `as string | Date` casts\n- `src/repositories/entryRepository.ts:165,195,315` - same casts in queries\n- `src/repositories/habitRepository.ts:72-73` - `as string | Date` casts\n\n**Problem:** The code uses type assertions to handle migration-period ambiguity:\n```typescript\ndate: normalizeDate(record.date as string | Date),\ncreatedAt: normalizeDate(record.createdAt as string | Date),\n```\n\nThe `EntryRecord` and `HabitRecord` interfaces declare these as `string`, but the code casts to `string | Date` to handle legacy data.\n\n**Issues:**\n1. Type safety is bypassed - TypeScript can't help catch issues\n2. The comments say \"migration period\" but there's no code to enforce or track migration completion\n3. If migration is complete, these casts should be removed\n\n**Recommendation:**\n1. If migration is ongoing: update the Record interfaces to reflect reality (`date: string | Date`)\n2. If migration is complete: remove the casts and let TypeScript verify\n3. Add a migration check or deprecation date","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:28:46.553277451Z","updated_at":"2025-12-23T19:28:46.553277451Z"}
{"id":"HT-a7c","title":"CRITICAL: Silent failure in toggleEntry() swallows database errors","description":"useHabitTrackerVM.ts:472-474: Database errors caught and only logged. User sees UI update but data NOT saved. This is a DATA LOSS scenario - user believes tracking saved when it's not. Show error feedback.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:55.918017115Z","updated_at":"2025-12-16T16:03:47.08050324Z","closed_at":"2025-12-16T16:03:47.08050324Z"}
{"id":"HT-6ya","title":"MAJOR: Date parsing without error handling in dataService.ts","description":"Lines 43-72: new Date() with invalid strings creates Invalid Date objects silently (getTime() returns NaN). These propagate into database. Add date validation with parseDate() helper that throws on invalid input.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.731638513Z","updated_at":"2025-12-16T16:39:06.496171235Z","closed_at":"2025-12-16T16:39:06.496171235Z"}
{"id":"HT-7nb","title":"tagUtils: wouldCreateCycle has shadowed variable name causing confusion","description":"**File:** humane-tracker/src/utils/tagUtils.ts:122-161\n\n**Issue:** The inner function `hasPathTo` at line 150 uses a for-loop variable named `childId`, which shadows the outer function parameter `childId` from line 124. This is confusing and error-prone:\n\n```typescript\nexport function wouldCreateCycle(\n  parentId: string,\n  childId: string,  // \u003c-- outer childId\n  allHabits: Map\u003cstring, Habit\u003e,\n): boolean {\n  // ...\n  function hasPathTo(fromId: string, targetId: string): boolean {\n    // ...\n    for (const childId of habit.childIds) {  // \u003c-- shadows outer!\n      if (hasPathTo(childId, targetId)) {\n```\n\n**Lines affected:** 150 - the for-loop variable shadows outer parameter\n\n**Recommendation:** Rename the inner loop variable to avoid shadowing:\n```typescript\nfor (const cid of habit.childIds) {\n  if (hasPathTo(cid, targetId)) {\n```","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:29:04.933983196Z","updated_at":"2025-12-23T19:29:04.933983196Z"}
{"id":"HT-wat","title":"DefaultHabit type allows any number for targetPerWeek, should constrain to 1-7","description":"In data/defaultHabits.ts, the DefaultHabit interface (line 4) defines:\n\n```typescript\nexport interface DefaultHabit {\n  name: string;\n  category: string;\n  targetPerWeek: number;  // Unconstrained\n  // ...\n}\n```\n\nBut the HabitRecord type uses TargetPerWeek which is documented as 1-7 days per week. The DEFAULT_HABITS array correctly uses values 1-7, but the type doesn't enforce this.\n\nSomeone could accidentally add a habit with targetPerWeek: 10 or targetPerWeek: 0, which would violate business rules.\n\nShould either:\n1. Import and use TargetPerWeek from repositories/types.ts\n2. Or add runtime validation in the habit creation service that processes defaultHabits","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:28:38.679789904Z","updated_at":"2025-12-23T19:28:38.679789904Z"}
{"id":"HT-x9g","title":"dateUtils: getTrailingWeekDateRange mutates input Date object side effect","description":"**File:** humane-tracker/src/utils/dateUtils.ts:6-24\n\n**Issue:** The function mutates the `currentDate` parameter when creating `endDate` and `startDate`:\n- Line 16: `const endDate = new Date(currentDate);` - creates copy (good)\n- Line 17: `endDate.setHours(23, 59, 59, 999);` - modifies copy (fine)\n- Line 19: `const startDate = new Date(currentDate);` - creates copy from ORIGINAL (good)\n\nWait, I re-read - this is actually fine. Both create copies from `currentDate`. No mutation of input.\n\nHowever, there's a potential issue: if called without arguments, `new Date()` is used. Two consecutive calls within a millisecond could return slightly different ranges if called right at midnight.\n\n**Actual issue:** None critical - the implementation is correct. Removing this issue.\n\nActually, one minor issue: The function name says \"trailing week\" but the JSDoc says \"today and 6 days back\" - this is 7 days total, which is a week. Clear enough.\n\n**Recommendation:** No changes needed - this function is well-implemented.","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-23T19:29:04.786140811Z","updated_at":"2025-12-23T19:29:11.385427371Z","closed_at":"2025-12-23T19:29:11.385427371Z"}
{"id":"HT-gl7","title":"habitRepository.update silently drops fields (hidden, trackingType, childIds, parentIds)","description":"The repository update function only handles 3 fields (name, category, targetPerWeek) but the service layer accepts Partial\u003cHabit\u003e. TypeScript's structural subtyping allows this mismatch, causing silent data loss.\n\nImpact: Visibility toggle, tracking type, and tag child edits in HabitSettings are silently dropped.\n\nRoot cause: Repository was never updated when new fields were added.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T01:59:57.156242698Z","updated_at":"2025-12-14T02:00:54.504536058Z","closed_at":"2025-12-14T02:00:54.504536058Z"}
{"id":"HT-4jf","title":"Remove variant fields from Habit type","description":"Remove from src/types/habit.ts and src/repositories/types.ts:\n- variants?: HabitVariant[]\n- allowCustomVariant?: boolean\n- HabitVariant interface\n- HabitVariantRecord interface\n\nAlso remove from habitRepository.ts any variant handling code.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:38:02.405139092Z","updated_at":"2025-12-13T23:54:04.754774964Z","closed_at":"2025-12-13T23:54:04.754774964Z","dependencies":[{"issue_id":"HT-4jf","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:21.927013936Z","created_by":"daemon"},{"issue_id":"HT-4jf","depends_on_id":"HT-3rn","type":"blocks","created_at":"2025-12-13T23:38:38.740307446Z","created_by":"daemon"},{"issue_id":"HT-4jf","depends_on_id":"HT-f2y","type":"blocks","created_at":"2025-12-13T23:38:38.772113727Z","created_by":"daemon"}]}
{"id":"HT-tjk","title":"MINOR: Video element cleanup in useBugReporter.ts","description":"Lines 149-165: Dynamically created video element has srcObject set but never explicitly cleaned up. Add video.pause() and video.srcObject = null after getting screenshot.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-16T15:37:36.585446061Z","updated_at":"2025-12-16T16:43:03.99490622Z","closed_at":"2025-12-16T16:43:03.99490622Z"}
{"id":"HT-6hp","title":"MAJOR: Stale closure in useVersionCheck checkForUpdate","description":"Lines 47-64: Dependency on isChecking causes potential race condition with rapid calls. Use a ref for the checking guard instead of state to avoid stale closure.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:19.130778527Z","updated_at":"2025-12-16T16:34:38.237953933Z","closed_at":"2025-12-16T16:34:38.237953933Z"}
{"id":"HT-c6r","title":"Comprehensive test coverage for tag system","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T00:10:52.607930294Z","updated_at":"2025-12-14T00:15:41.853330686Z","closed_at":"2025-12-14T00:15:41.853330686Z"}
{"id":"HT-31j","title":"categoryUtils: hashString returns 0 for empty string input","description":"**File:** humane-tracker/src/utils/categoryUtils.ts:7-15\n\n**Issue:** The `hashString` function returns 0 for empty strings, but `getCategoryColor` already handles empty strings separately. However, if someone calls `hashString(\"\")` directly, they get 0 which could cause collision with other strings that happen to hash to 0.\n\nMore critically, `hashString` is only used internally, but the function lacks input validation. While `getCategoryColor` guards for empty/whitespace, a future direct use of `hashString` could cause issues.\n\n**Recommendation:** Make `hashString` a truly private implementation detail (not exported or rename with underscore prefix), or add validation.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:29:04.622720114Z","updated_at":"2025-12-23T19:29:04.622720114Z"}
{"id":"HT-hrx","title":"Arbitrary timeout in App.tsx auth check instead of proper waiting","description":"In App.tsx:60-74, the auth check uses an arbitrary 500ms timeout to wait for Dexie Cloud to initialize:\n\n```typescript\nconst checkAuth = async () =\u003e {\n  try {\n    // Wait a bit for Dexie Cloud to initialize\n    await new Promise((resolve) =\u003e setTimeout(resolve, 500));\n    setLoading(false);\n  } catch (error) {\n    console.error(\"Error checking auth:\", error);\n    setLoading(false);\n  }\n};\n```\n\nThis is fragile - 500ms may not be enough on slow connections, and is wasteful on fast connections. Should use proper Dexie Cloud ready state or observable subscription instead of arbitrary timeout.\n\nPer CLAUDE.md: \"NEVER use arbitrary timeouts - always wait for actual IndexedDB state changes.\"","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:28:38.54056872Z","updated_at":"2025-12-23T19:28:38.54056872Z"}
{"id":"HT-8bi","title":"Phase 2: Recording hook (useAudioRecorder)","description":"MediaRecorder wrapper with permission handling, duration tracking, 5-min limit","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T22:19:20.063846715Z","updated_at":"2025-12-23T22:26:25.203628598Z","closed_at":"2025-12-23T22:26:25.203628598Z","dependencies":[{"issue_id":"HT-8bi","depends_on_id":"HT-8ks","type":"parent-child","created_at":"2025-12-23T22:19:30.529113317Z","created_by":"daemon"}]}
{"id":"HT-u9h","title":"habitTreeUtils: computeTagCounts has impure function semantics (modifies return semantics)","description":"**File:** humane-tracker/src/utils/habitTreeUtils.ts:141-173\n\n**Issue:** The JSDoc says \"This modifies the HabitWithStatus.currentWeekCount for tags\" but the function actually returns NEW objects for tags (using spread operator at line 167). The comment is misleading.\n\nAdditionally, the function is wasteful for large habit lists - it maps over ALL habits even though only tags need processing.\n\n**Minor issues:**\n1. Misleading JSDoc comment about mutation\n2. Line 162: The date handling duplicates logic that exists in `toDateString` - could just call `toDateString(e.date)` directly since `toDateString` in types.ts handles Date|string\n\n**Recommendation:** \n1. Update JSDoc to say \"Returns habits with updated currentWeekCount for tags\"\n2. Consider optimizing by only processing tags","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:29:04.842546287Z","updated_at":"2025-12-23T19:29:04.842546287Z"}
{"id":"HT-b47","title":"Add aria-label to icon-only buttons in HabitSettings","description":"HabitSettings.tsx has buttons that use only emoji/icon content without accessible labels:\n\n1. Line 529-544: Visibility toggle button uses only emoji (eye icons)\n   ```tsx\n   \u003cbutton className={`visibility-btn ...`} onClick={...} title={...}\u003e\n     {getHabitValue(habit, \"hidden\") ? \"eye emoji\" : \"eye emoji\"}\n   \u003c/button\u003e\n   ```\n   Has title attribute but missing aria-label.\n\n2. Line 546-556: Delete button uses only \"X\" character\n   ```tsx\n   \u003cbutton className={`delete-btn ...`} onClick={...} title={...}\u003e\n     X\n   \u003c/button\u003e\n   ```\n   Has title attribute but missing aria-label.\n\nBest practice: Use aria-label for icon-only buttons. The title attribute is for hover tooltips and is not reliably read by screen readers.\n\nAdd: aria-label matching the title content for both buttons.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T19:29:27.237262387Z","updated_at":"2025-12-23T22:22:41.083484667Z","closed_at":"2025-12-23T22:22:41.083484667Z"}
{"id":"HT-kfl","title":"MAJOR: E2E tests use arbitrary timeouts instead of polling","description":"habit-click.spec.ts uses page.waitForTimeout(500) in several places despite having IndexedDB polling helpers. Per CLAUDE.md: \"NEVER use arbitrary timeouts\". Replace with proper waitFor conditions.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:12.835885661Z","updated_at":"2025-12-16T15:37:12.835885661Z"}
{"id":"HT-gui","title":"CRITICAL: Memory leak - uncleared setTimeout in HabitTracker.tsx","description":"Lines 39-40, 69-76: longPressTimer ref timer is only cleared via event handlers. If component unmounts while timer pending, it still fires. Add cleanup effect.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.714348114Z","updated_at":"2025-12-16T16:00:14.96068356Z","closed_at":"2025-12-16T16:00:14.96068356Z"}
{"id":"HT-tr1","title":"Tag CRUD: Create and manage tags in HabitSettings","description":"Add UI to create tag habits and assign children.\n\nFeatures:\n- Toggle habitType when creating new habit (raw vs tag)\n- For tags: select which habits to include as children\n- For raw habits: show which tags they belong to\n- Add/remove children from existing tags","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T22:22:26.076540164Z","updated_at":"2025-12-13T22:52:57.544719071Z","closed_at":"2025-12-13T22:52:57.544719071Z","dependencies":[{"issue_id":"HT-tr1","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.621730836Z","created_by":"daemon"},{"issue_id":"HT-tr1","depends_on_id":"HT-7ic","type":"blocks","created_at":"2025-12-13T22:22:43.112066096Z","created_by":"daemon"}]}
{"id":"HT-aya","title":"Tag Habits Implementation","description":"Implement the Raw Habits + Tags model as specified in TAG-HABITS-SPEC.md.\n\nKey features:\n- Raw habits (concrete activities) vs Tags (aggregations)\n- Arbitrary nesting of tags\n- Multi-tag membership for raw habits\n- Write loose, structure later (notes + LLM parsing)\n- Independent targets for both raw habits and tags","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T22:22:03.965683924Z","updated_at":"2025-12-13T22:55:58.996148706Z","closed_at":"2025-12-13T22:55:58.996148706Z"}
{"id":"HT-hzm","title":"DeviceService.getStorageItem silently swallows errors without logging","description":"**File:** `humane-tracker/src/services/DeviceService.ts:6-11`\n\n`getStorageItem()` catches all errors and returns `null` without any logging or visibility into what went wrong. While the return value signals failure, there's no way to diagnose why localStorage access failed (quota exceeded, private browsing, security restrictions, etc.).\n\nIn contrast, `setStorageItem()` on line 20-21 does log a warning on failure.\n\n**Fix:** Add a console.warn similar to setStorageItem for consistency:\n```typescript\n} catch (error) {\n  console.warn(`[DeviceService] Failed to read localStorage (key: ${key}).`, error);\n  return null;\n}\n```","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-23T19:28:32.681299661Z","updated_at":"2025-12-23T19:28:32.681299661Z"}
{"id":"HT-a82","title":"MAJOR: Missing date validation in dateUtils.ts getTrailingWeekDateRange","description":"Line 5: No validation that currentDate is valid Date. If passed Invalid Date, function produces garbage output with no error. Add validation: if (isNaN(currentDate.getTime())) throw.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:12.561198549Z","updated_at":"2025-12-16T16:35:15.35181836Z","closed_at":"2025-12-16T16:35:15.35181836Z"}
{"id":"HT-4nb","title":"CRITICAL: Type safety - value field accepts any number","description":"EntryRecord.value and HabitEntry.value typed as number but codebase uses specific values (0, 0.5, 1-5). Negative or unexpected floats type-check fine. Create constrained type like EntryValue = 0 | 0.5 | 1 | 2 | 3 | 4 | 5.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:56.13084926Z","updated_at":"2025-12-16T16:28:01.639173595Z","closed_at":"2025-12-16T16:28:01.639173595Z"}
{"id":"HT-17p","title":"MAJOR: Deprecated navigator.platform in githubService.ts","description":"Lines 51-55: navigator.platform is deprecated. May return empty strings or be removed in future browsers. Use navigator.userAgentData?.platform with fallback.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.870049197Z","updated_at":"2025-12-16T16:36:09.339740936Z","closed_at":"2025-12-16T16:36:09.339740936Z"}
{"id":"HT-qhe","title":"Performance: useBugReporter recalculates isMobile and screenshotSupported every render","description":"File: humane-tracker/src/hooks/useBugReporter.ts:67-78\n\nTwo computed values are recalculated on every render unnecessarily:\n\n1. `isMobile` (lines 67-71) - runs a regex test on `navigator.userAgent` every render\n2. `screenshotSupported` (lines 74-78) - checks navigator capabilities every render\n\nThese values never change during the component lifecycle (user agent and available APIs don't change).\n\nFix: Wrap both in `useMemo` with empty dependency arrays, or compute them once at module level since they're static.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:28:15.589758509Z","updated_at":"2025-12-23T19:28:15.589758509Z"}
{"id":"HT-1sd","title":"Missing unmount guard in useHabitTrackerVM async effect","description":"File: humane-tracker/src/hooks/useHabitTrackerVM.ts:284-361\n\nThe useEffect starting at line 284 calls `loadHabits()` asynchronously (line 353), but the cleanup function only unsubscribes from the subscriptions. If the component unmounts while `loadHabits()` is still running, the promise will resolve and call `setHabits()`, `setIsLoading()`, etc. on an unmounted component.\n\nWhile React 18 handles this more gracefully than older versions, it's still a potential source of warnings and unexpected behavior.\n\nFix: Add an `isMounted` ref that gets set to false in cleanup, and check it before calling setState in `loadHabits`.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:28:15.563902373Z","updated_at":"2025-12-23T19:28:15.563902373Z"}
{"id":"HT-0pq","title":"MAJOR: targetPerWeek type accepts any number","description":"HabitRecord.targetPerWeek typed as number but valid values are 1-7. Create constrained type: type TargetPerWeek = 1 | 2 | 3 | 4 | 5 | 6 | 7.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:12.651156013Z","updated_at":"2025-12-16T16:45:31.860344772Z","closed_at":"2025-12-16T16:45:31.860344772Z"}
{"id":"HT-e2i","title":"DRY violation: Alert and error handling duplicated across db.ts migrations","description":"In config/db.ts, the same error handling pattern is copy-pasted in migrations v4 (lines 157-186), v5 (lines 216-246), and v6 (lines 358-385):\n\n```typescript\n} catch (error) {\n  console.error(\"[Migration vN] CRITICAL: Database migration failed:\", error);\n  if (error instanceof Error \u0026\u0026 error.stack) {\n    console.error(\"[Migration vN] Stack trace:\", error.stack);\n  }\n  const errorMsg = error instanceof Error ? error.message : String(error);\n  console.error(`[Migration vN] User notification: ...`);\n  if (typeof window !== \"undefined\" \u0026\u0026 !window.location.search.includes(\"test=true\")) {\n    alert(`Database migration failed: ${errorMsg}\\n\\n...`);\n  }\n  throw error;\n}\n```\n\nThis should be refactored into a shared helper function like `handleMigrationError(version: number, error: unknown)` to avoid duplication and ensure consistent error handling across all migrations.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-23T19:28:38.590695463Z","updated_at":"2025-12-23T19:28:38.590695463Z"}
{"id":"HT-2cd","title":"Inconsistent validation: habitRepository.bulkCreate() uses toRecord() but bulkPut() doesn't","description":"**File:** `src/repositories/habitRepository.ts`\n\n**Inconsistency:**\n- `create()` (line 206-227): Uses `toRecord()` which validates name, category, targetPerWeek\n- `bulkCreate()` (line 232-244): Uses `toRecord()` which validates\n- `bulkPut()` (line 344-372): Does NOT use `toRecord()`, manually maps fields without validation\n\n**Problem:** `bulkPut()` is used for imports. It bypasses all validation that `create()` and `bulkCreate()` enforce.\n\nThis is related to HT-d46 but specific to the inconsistency within habitRepository.\n\n**Fix:** Have `bulkPut()` use the same validation path as `create()`, or refactor to share validation code.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:29:12.546191903Z","updated_at":"2025-12-23T19:29:12.546191903Z"}
{"id":"HT-vmu","title":"Clean up variant CSS","description":"Remove variant-related CSS:\n- .has-variants class in HabitTracker.css\n- .variant-trigger button styles\n- Any other variant-specific styles\n\nKeep TagChildPicker styles (they're different).","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T23:38:03.669661393Z","updated_at":"2025-12-13T23:54:04.757092693Z","closed_at":"2025-12-13T23:54:04.757092693Z","dependencies":[{"issue_id":"HT-vmu","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:22.475160717Z","created_by":"daemon"}]}
{"id":"HT-er4","title":"Dexie Cloud Synchronization Hardening","description":"Address synchronization issues identified in architecture review to prevent data loss and race conditions when using Dexie Cloud sync.\n\n## Context\nAudit against Dexie Cloud best practices revealed several patterns that could cause data loss or inconsistencies during cloud sync operations.\n\n## Key Issues\n1. Non-atomic import/replace operations\n2. Using put() instead of update() loses concurrent edits\n3. Read-condition-write patterns in cleanup operations\n\n## References\n- https://dexie.org/docs/cloud/consistency\n- https://dexie.org/docs/cloud/best-practices","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T14:17:09.686565221Z","updated_at":"2025-12-13T15:06:12.117426725Z","closed_at":"2025-12-13T15:06:12.117426725Z"}
{"id":"HT-zca","title":"CRITICAL: Potential DoS via large base64 input in githubService.ts","description":"Line 204: dataUrlToBlob() has no size limit. Very large base64 string could cause memory exhaustion. Add MAX_DATA_URL_SIZE check (e.g., 10MB) before processing.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-16T15:35:30.93011013Z","updated_at":"2025-12-16T16:00:15.156352919Z","closed_at":"2025-12-16T16:00:15.156352919Z"}
{"id":"HT-8ds","title":"Data integrity: habitRepository.delete() silently succeeds when habit doesn't exist","description":"**File:** `src/repositories/habitRepository.ts:302-314`\n\n**Problem:** Same as entryRepository.delete() - the `delete()` method calls `db.habits.delete()` without verifying the habit exists.\n\n**Impact:** Caller thinks delete succeeded when the habit never existed.\n\n**Fix:** Same pattern - check existence before delete.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T19:28:03.182362081Z","updated_at":"2025-12-23T22:14:25.308720041Z","closed_at":"2025-12-23T22:14:25.308720041Z"}
{"id":"HT-4j9","title":"MAJOR: Missing form accessibility in BugReportDialog.tsx","description":"Lines 99-122: Dialog lacks role=\"dialog\" and aria-modal=\"true\". Submit button missing aria-describedby for error message. Add accessibility attributes.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:18.93225638Z","updated_at":"2025-12-16T16:29:20.430157864Z","closed_at":"2025-12-16T16:29:20.430157864Z"}
{"id":"HT-76v","title":"Update tests: remove variant-related tests","description":"Review and update test files:\n- Remove tests for variant functionality\n- Add tests for tag migration\n- Ensure tag-based tests are comprehensive\n\nCheck:\n- src/repositories/habitRepository.test.ts\n- src/hooks/useHabitTrackerVM.test.ts\n- src/utils/tagUtils.test.ts\n- Any E2E tests using variants","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T23:38:03.414313275Z","updated_at":"2025-12-13T23:54:04.756657647Z","closed_at":"2025-12-13T23:54:04.756657647Z","dependencies":[{"issue_id":"HT-76v","depends_on_id":"HT-41t","type":"parent-child","created_at":"2025-12-13T23:38:22.219975645Z","created_by":"daemon"}]}
{"id":"HT-zoq","title":"MAJOR: Unsafe date parsing in tagUtils.ts","description":"Lines 261-263, 291, 307: Uses inline 'e.date instanceof Date ? e.date : new Date(e.date)' pattern. new Date(string) doesn't validate format. Use normalizeDate() from types.ts instead.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:37:12.513212371Z","updated_at":"2025-12-16T16:37:04.116229123Z","closed_at":"2025-12-16T16:37:04.116229123Z"}
{"id":"HT-0r2","title":"Fix read-condition-write race in CleanupDuplicates","description":"**Severity: Medium**\n\n`CleanupDuplicates.tsx` uses a read-condition-write pattern that's vulnerable to race conditions with cloud sync.\n\n## Current Code\n```typescript\n// Read all habits\nconst habits = await habitService.getAllHabitsForUser(userId);\n// Find duplicates in JS\nconst duplicates = findDuplicates(habits);\n// Delete sequentially\nfor (const dup of duplicates) {\n  await habitService.deleteHabit(dup.id);  // Each delete triggers subscription\n}\n```\n\n## Problems\n1. If cloud sync pushes a new habit between read and delete, could delete wrong item\n2. Sequential deletes trigger subscription updates between each one\n3. User could add a habit during cleanup, causing unpredictable behavior\n\n## Solution Options\n\n**Option A: Batch delete in transaction**\n```typescript\nawait db.transaction('rw', db.habits, async () =\u003e {\n  const duplicateIds = [...]; // IDs determined before transaction\n  await db.habits.bulkDelete(duplicateIds);\n});\n```\n\n**Option B: Use where-clause (preferred for Dexie Cloud)**\n```typescript\n// Group habits by name, delete all but first in each group\n// Conditions travel to server and re-execute there\n```\n\n## Reference\nhttps://dexie.org/docs/cloud/consistency\n\u003e \"Avoid reading + JS condition + writing. Instead formulate the condition in a where-clause with a modify expression attached to it.\"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T14:17:40.938560534Z","updated_at":"2025-12-13T15:06:05.793435618Z","closed_at":"2025-12-13T15:06:05.793435618Z","dependencies":[{"issue_id":"HT-0r2","depends_on_id":"HT-er4","type":"parent-child","created_at":"2025-12-13T14:17:47.391597493Z","created_by":"daemon"}]}
{"id":"HT-5b4","title":"Add type=\"button\" to buttons inside forms to prevent accidental submission","description":"Buttons inside form elements default to type=\"submit\" if not specified. This can cause unexpected form submissions when clicking non-submit buttons.\n\nAffected files:\n- HabitManager.tsx:61 - Close button inside form lacks type=\"button\"\n  `\u003cbutton className=\"close-btn\" onClick={onClose}\u003ex\u003c/button\u003e`\n  This button is inside the form element at line 66.\n\nBest practice: Always explicitly specify type=\"button\" for buttons that should not submit the form.\n\nNote: Most other dialogs either use forms correctly or have buttons outside forms. The HabitManager case is the only one where a close button is inside a form element.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T19:29:26.004783442Z","updated_at":"2025-12-23T22:22:41.624223817Z","closed_at":"2025-12-23T22:22:41.624223817Z"}
{"id":"HT-4yl","title":"Add role=\"dialog\" and aria-modal to modal overlays","description":"Several modal dialogs are missing proper ARIA dialog attributes for screen reader accessibility.\n\nAffected files:\n- DebugLogsDialog.tsx:137 - Dialog overlay missing role=\"dialog\" and aria-modal\n- SyncStatusDialog.tsx:225 - Dialog overlay missing role=\"dialog\" and aria-modal\n- HabitEditor.tsx:114 - Dialog overlay missing role=\"dialog\" and aria-modal\n- HabitManager.tsx:57 - Dialog overlay missing role=\"dialog\" and aria-modal\n- HabitSettings.tsx:383-395 - Dialog overlay missing role=\"dialog\" and aria-modal\n- SignInDialog.tsx:18 - Dialog overlay missing role=\"dialog\" and aria-modal\n- SettingsDialog.tsx:54 - Dialog overlay missing role=\"dialog\" and aria-modal\n\nGood examples already in codebase:\n- BugReportDialog.tsx:60-65 correctly uses role=\"dialog\" aria-modal=\"true\" aria-labelledby\n- CleanupDuplicates.tsx:96-99 correctly uses role=\"dialog\" aria-modal=\"true\" aria-labelledby\n\nAll modal overlays should have:\n- role=\"dialog\"\n- aria-modal=\"true\"\n- aria-labelledby pointing to the dialog title","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T19:29:24.856959587Z","updated_at":"2025-12-23T22:22:41.947982121Z","closed_at":"2025-12-23T22:22:41.947982121Z"}
{"id":"HT-syv","title":"githubService.openBugReport silently fails clipboard write without user notification","description":"**File:** `humane-tracker/src/services/githubService.ts:309-320`\n\nWhen the user captures a screenshot for a bug report, the screenshot is supposed to be copied to clipboard. If this fails (lines 317-320), we only log to console and proceed without notifying the user.\n\n**Impact:** User thinks they can paste a screenshot into the GitHub issue, but their clipboard doesn't have it. They may not check the console.\n\n**Current code:**\n```typescript\n} catch (error) {\n  console.warn(\"Failed to copy screenshot to clipboard:\", error);\n  // Don't fallback to text - user didn't ask for text in clipboard\n}\n```\n\n**Fix:** Return a status object or set a flag that the UI can use to show a warning:\n```typescript\n// Return type could be { body: string; screenshotCopied: boolean }\n// UI can then show: \"Note: Screenshot could not be copied to clipboard\"\n```","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-23T19:28:32.744697625Z","updated_at":"2025-12-23T19:28:32.744697625Z"}
{"id":"HT-eyr","title":"MAJOR: Missing ARIA labels in CleanupDuplicates.tsx modal","description":"Lines 171-200: Modal overlay and buttons lack accessibility attributes. Add role=\"dialog\", aria-modal=\"true\", aria-labelledby for modal, and aria-labels for buttons.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:18.873149088Z","updated_at":"2025-12-16T16:28:53.955246851Z","closed_at":"2025-12-16T16:28:53.955246851Z"}
{"id":"HT-umt","title":"MAJOR: Returning mutable ref in useHabitTrackerVM exposes internal state","description":"Line 492: Returns expandedTagsRef.current directly, exposing mutable Set reference. Components can mutate directly, bypassing controlled toggleTagExpanded. Return new Set or ReadonlySet instead.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:19.189628652Z","updated_at":"2025-12-16T16:32:01.433991784Z","closed_at":"2025-12-16T16:32:01.433991784Z"}
{"id":"HT-t2a","title":"tagUtils: getTagWeeklyCount date filtering uses time comparison but date-only semantics expected","description":"**File:** humane-tracker/src/utils/tagUtils.ts:278-312\n\n**Issue:** The `getTagWeeklyCount` function filters entries by comparing timestamps (lines 293-296), but this includes the TIME component. If `startDate` is set to midnight and an entry has a timestamp at 11:59 PM the previous day, it would be incorrectly excluded.\n\nMore specifically:\n- Line 293: `if (startDate \u0026\u0026 entryTime \u003c startDate.getTime())` - compares full timestamps\n- But the function counts \"unique days\" (line 304) suggesting date-only semantics\n\nThis mismatch means the filtering and counting have different semantics.\n\n**Example bug:**\n- startDate = 2024-01-01 00:00:00\n- entry.date = 2024-01-01 23:59:59\n- entryTime \u003e= startDate.getTime() âœ“ (included correctly)\n- But if entry.date = 2023-12-31 23:59:59, it's excluded even though for date-only comparison it should be\n\nThe function should either:\n1. Normalize dates to start-of-day before comparison\n2. Use toDateString comparison for both filtering and counting\n\n**Recommendation:** Use consistent date-string comparison:\n```typescript\nconst startDateStr = startDate ? toDateString(startDate) : null;\nconst endDateStr = endDate ? toDateString(endDate) : null;\nconst entryDateStr = toDateString(entryDate);\nif (startDateStr \u0026\u0026 entryDateStr \u003c startDateStr) return false;\nif (endDateStr \u0026\u0026 entryDateStr \u003e endDateStr) return false;\n```","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T19:29:04.958471377Z","updated_at":"2025-12-23T22:14:26.301121884Z","closed_at":"2025-12-23T22:14:26.301121884Z"}
{"id":"HT-aio","title":"Add missing aria-label to Reload button in VersionNotification","description":"The Reload button in VersionNotification.tsx is missing an aria-label, making it less accessible for screen reader users.\n\nFile: VersionNotification.tsx\nLine 79-92: The Reload button has no aria-label:\n```tsx\n\u003cbutton\n  onClick={reload}\n  style={{...}}\n\u003e\n  Reload\n\u003c/button\u003e\n```\n\nWhile the button has visible text \"Reload\", adding an aria-label like \"Reload application to get the latest version\" would provide better context for screen reader users.\n\nThe dismiss button at line 93-117 correctly has aria-label=\"Dismiss update notification\".","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T19:29:26.612041087Z","updated_at":"2025-12-23T19:29:26.612041087Z"}
{"id":"HT-tx3","title":"habitTreeUtils: buildHabitTree doesn't detect or warn about cycles","description":"**File:** humane-tracker/src/utils/habitTreeUtils.ts:38-105\n\n**Issue:** The `buildHabitTree` function recursively builds a tree but doesn't detect cycles. If the data has a cycle (A -\u003e B -\u003e A), the `buildNode` function at line 80 will recurse infinitely, causing a stack overflow.\n\nWhile `tagUtils.ts` has `wouldCreateCycle` to prevent creating cycles, existing corrupt data could still cause this issue.\n\n**Lines affected:** 80-102 (the `buildNode` recursive function)\n\n**Recommendation:** Add a `visited` Set parameter to `buildNode` and skip already-visited nodes:\n```typescript\nfunction buildNode(habit: HabitWithStatus, depth: number, visited = new Set\u003cstring\u003e()): HabitTreeNode {\n  if (visited.has(habit.id)) {\n    console.warn(`Cycle detected: ${habit.id}`);\n    return { habit, depth, isTag, isExpanded, childNodes: [] };\n  }\n  visited.add(habit.id);\n  // ... rest of function\n}\n```","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T19:29:04.816221098Z","updated_at":"2025-12-23T22:14:25.838068246Z","closed_at":"2025-12-23T22:14:25.838068246Z"}
{"id":"HT-km3","title":"MAJOR: Race condition in syncLogService.enforceLimit()","description":"Lines 93-104: Race condition between counting, reading oldest, and deleting logs. Multiple addLog() calls could delete more logs than intended. Wrap in transaction or add debounce/mutex.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.780168234Z","updated_at":"2025-12-16T16:42:38.139454834Z","closed_at":"2025-12-16T16:42:38.139454834Z"}
{"id":"HT-89h","title":"CRITICAL: Missing unit tests for transactions.ts","description":"runImportTransaction() handles atomic imports but has no tests verifying: transaction rollback on failure, \"replace\" mode clears all tables, \"merge\" mode preserves existing data.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T15:35:56.090589771Z","updated_at":"2025-12-16T16:25:57.860594864Z","closed_at":"2025-12-16T16:25:57.860594864Z"}
{"id":"HT-9ev","title":"Tracker View: Click-on-tag picker","description":"When clicking a tag habit cell, open picker to select which child raw habit to log.\n\nFlow:\n- Click tag cell â†’ opens picker showing child raw habits\n- Select child â†’ creates entry on that raw habit\n- Tag count updates automatically (computed from children)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T22:22:26.558300571Z","updated_at":"2025-12-13T22:55:43.725429496Z","closed_at":"2025-12-13T22:55:43.725429496Z","dependencies":[{"issue_id":"HT-9ev","depends_on_id":"HT-aya","type":"parent-child","created_at":"2025-12-13T22:22:36.685166037Z","created_by":"daemon"},{"issue_id":"HT-9ev","depends_on_id":"HT-k2n","type":"blocks","created_at":"2025-12-13T22:22:43.172165618Z","created_by":"daemon"}]}
{"id":"HT-6pj","title":"MAJOR: Confusing status logic in habitService.ts","description":"Lines 75-85: Logic for \"today\" vs \"tomorrow\" status is confusing and potentially wrong. When daysNeeded \u003e= targetPerWeek and todayEntry exists, falls through to \"pending\". Status distinction seems arbitrary.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-16T15:36:48.686916261Z","updated_at":"2025-12-16T15:36:48.686916261Z"}
